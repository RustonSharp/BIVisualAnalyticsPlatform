# 用户使用手册

## 目录

1. [安装与启动](#安装与启动)
2. [数据源配置](#数据源配置)
3. [图表设计](#图表设计)
4. [仪表盘构建](#仪表盘构建)
5. [数据筛选](#数据筛选)
6. [导出与分享](#导出与分享)
7. [常见问题](#常见问题)

---

## 安装与启动

### 系统要求

- **操作系统**: Windows 10+, macOS 11+, Ubuntu 20.04+
- **Python**: 3.8 或更高版本
- **浏览器**: Chrome 90+, Edge 90+, Firefox 88+

### 安装步骤

1. **下载项目**

```bash
git clone https://github.com/yourusername/bi-visual-analytics.git
cd BIVisualAnalyticsPlatform
```

2. **安装依赖**

```bash
pip install -r requirements.txt
```

3. **启动应用**

```bash
python app.py
```

4. **访问应用**

在浏览器中打开 `http://localhost:8050`

---

## 数据源配置

### 方式 1：CSV/Excel 文件

**适用场景**: 本地数据文件、小规模数据分析

**操作步骤**:

1. 点击导航栏 **"数据源"** 菜单
2. 在 "数据源类型" 下拉框中选择 **"CSV / Excel 文件"**
3. 填写配置信息：
   - **数据源名称**: 为数据源命名（如"销售数据"）
   - **文件路径**: 输入文件路径（如 `data/sample_sales.csv`）
   - **编码方式**: 选择文件编码（通常为 UTF-8）
   - **分隔符**: CSV 文件的分隔符（逗号/制表符/分号）
4. 点击 **"测试连接"** 验证文件是否可读
5. 查看 **"数据预览"** 确认数据正确
6. 点击 **"保存配置"** 完成

**提示**:
- 文件路径支持相对路径（相对于项目根目录）
- Excel 文件会自动读取第一个工作表
- 系统会自动识别字段类型（数字/日期/文本）

---

### 方式 2：数据库连接

**适用场景**: 企业数据仓库、大规模数据分析

**支持的数据库**:
- PostgreSQL
- MySQL

**操作步骤**:

1. 选择数据源类型为 **"数据库 (PostgreSQL/MySQL)"**
2. 填写连接信息：
   - **数据库类型**: 选择 PostgreSQL 或 MySQL
   - **主机地址**: 数据库服务器地址（如 `localhost`）
   - **端口**: 端口号（PostgreSQL 默认 5432，MySQL 默认 3306）
   - **数据库名**: 要连接的数据库名称
   - **用户名**: 数据库用户名
   - **密码**: 数据库密码
   - **表名**: 要查询的表名（可选，可后续指定）
3. 点击 **"测试连接"** 验证连接
4. 保存配置

**安全提示**:
- 密码会加密存储，不建议在配置文件中明文保存
- 建议创建只读用户用于 BI 分析

---

### 方式 3：REST API

**适用场景**: 第三方数据接口、实时数据更新

**操作步骤**:

1. 选择数据源类型为 **"REST API"**
2. 填写 API 信息：
   - **API URL**: 接口地址（如 `https://api.example.com/data`）
   - **请求方法**: 选择 GET 或 POST
   - **JSON 数据路径**: 如果数据嵌套在 JSON 中，指定路径（如 `data.results`）
   - **API Key**: 如果需要认证，填写 API 密钥
3. 测试连接并预览数据
4. 保存配置

**示例**:

假设 API 返回格式：
```json
{
  "status": "success",
  "data": {
    "results": [
      {"date": "2024-01-01", "sales": 1000},
      {"date": "2024-01-02", "sales": 1200}
    ]
  }
}
```

则 JSON 数据路径应填写：`data.results`

---

## 图表设计

### 步骤 1：选择数据源

1. 点击 **"图表设计"** 菜单
2. 左侧会显示已配置的数据源字段列表

### 步骤 2：配置图表

1. **选择图表类型**：
   - 📈 折线图 - 适合时间趋势分析
   - 📊 柱状图 - 适合类别对比
   - 🥧 饼图 - 适合占比分析
   - 📋 表格 - 适合明细数据展示
   - ⚪ 散点图 - 适合相关性分析
   - 📉 面积图 - 适合累积趋势

2. **配置数据维度**：
   - **X 轴**: 选择作为 X 轴的字段（通常为时间或分类）
   - **Y 轴**: 选择作为 Y 轴的数值字段
   - **分组字段**: 可选，用于多系列图表

3. **数据聚合**（可选）：
   - **求和** - 计算总和
   - **平均值** - 计算均值
   - **计数** - 统计数量
   - **最大值/最小值** - 找出极值

4. **样式定制**：
   - **图表标题**: 为图表命名
   - **配色方案**: 选择预设配色（默认/商务/海洋/大地/日落）

### 步骤 3：生成预览

点击 **"生成图表"** 按钮，右侧会实时显示图表预览。

### 示例：创建月度销售趋势图

1. 图表类型：折线图
2. X 轴：date（日期字段）
3. Y 轴：sales（销售额字段）
4. 聚合函数：求和
5. 标题：月度销售趋势
6. 配色：商务

---

## 仪表盘构建

### 什么是仪表盘？

仪表盘是多个图表和筛选器的集合，用于全面展示业务数据。

### 创建仪表盘

1. 点击 **"仪表盘"** 菜单
2. 左侧配置筛选器（见下一节）
3. 右侧点击 **"+ 添加图表"** 添加已设计的图表
4. 拖拽调整图表位置和大小
5. 保存仪表盘配置

### 仪表盘布局

- 采用 **12 列栅格系统**
- 图表可自由拖拽调整位置
- 支持调整图表大小（宽度/高度）

---

## 数据筛选

### 时间范围筛选

**快捷选项**:
- 今天
- 昨天
- 近 7 天
- 近 30 天
- 本月
- 上月

**自定义范围**:
- 点击 "自定义"，使用日期选择器指定起止日期

### 类别筛选

支持对分类字段进行多选筛选，如：
- 地区：华东、华南、华北
- 产品类别：电子产品、家具
- 销售渠道：线上、线下

### 应用筛选

1. 在左侧筛选面板配置筛选条件
2. 点击 **"应用筛选"** 按钮
3. 所有关联图表会自动更新

### 重置筛选

点击 **"重置"** 按钮恢复默认状态。

---

## 导出与分享

### 导出图表为图片

**适用场景**: 会议汇报、邮件发送

**步骤**:
1. 点击 **"导出"** 菜单
2. 选择导出格式：**PNG 图片**
3. 输入文件名（如 `sales_chart`）
4. 点击 **"导出"** 按钮
5. 文件会保存到项目的 `exports/` 目录

---

### 导出仪表盘为 PDF

**适用场景**: 打印报告、存档

**步骤**:
1. 选择导出格式：**PDF 文档**
2. 输入文件名
3. 点击导出

PDF 会包含仪表盘中的所有图表。

---

### 导出为静态 HTML

**适用场景**: 离线分享、发送给没有系统权限的人

**步骤**:
1. 选择导出格式：**静态 HTML**
2. 输入文件名
3. 点击导出

生成的 HTML 文件包含所有数据和交互功能，可直接在浏览器中打开，无需服务器。

---

### 导出原始数据

**步骤**:
1. 选择导出格式：**CSV 数据**
2. 输入文件名
3. 点击导出

会导出当前筛选条件下的原始数据。

---

## 常见问题

### Q1: 文件路径填写错误怎么办？

**A**: 确保文件路径相对于项目根目录。例如：
- ✅ 正确：`data/sales.csv`
- ❌ 错误：`C:\Users\...\sales.csv`（绝对路径可能在不同环境下失效）

---

### Q2: 数据库连接失败？

**A**: 检查以下几点：
1. 数据库服务是否启动
2. 主机地址和端口是否正确
3. 用户名和密码是否正确
4. 数据库是否允许远程连接（检查防火墙/安全组）

---

### Q3: 图表显示空白？

**A**: 可能原因：
1. 数据为空 - 检查筛选条件是否过于严格
2. 字段选择错误 - 确认 X/Y 轴字段存在于数据中
3. 数据类型不匹配 - 数值图表需要数值型字段

---

### Q4: 如何处理大数据量？

**A**: 
1. 使用聚合函数（如按日期聚合）减少数据点
2. 在数据源层面添加 LIMIT 限制
3. 使用时间筛选器缩小范围

---

### Q5: 如何修改已保存的仪表盘？

**A**: 
1. 在 "仪表盘" 菜单中找到对应仪表盘
2. 点击 "编辑" 按钮
3. 修改后重新保存

---

### Q6: 导出的 PDF 中文显示乱码？

**A**: 
1. 确保安装了支持中文的字体
2. 检查数据源编码是否为 UTF-8
3. 如问题依旧，建议导出为 HTML 或 PNG

---

### Q7: API 数据刷新频率如何设置？

**A**: 
在仪表盘配置中可设置刷新间隔（5 分钟/10 分钟/30 分钟/1 小时）。
或点击手动刷新按钮。

---

### Q8: 如何实现图表联动？

**A**: 
在仪表盘模式下：
1. 确保多个图表使用相同的数据源
2. 点击一个图表中的数据点
3. 其他图表会自动筛选显示相关数据

**示例**：点击地区柱状图中的"华东"，产品饼图会自动显示华东地区的产品分布。

---

### Q9: 如何实现数据下钻？

**A**: 
双击图表中的某个数据点，可从汇总数据深入到明细数据。

**示例层级**：
- 时间：年 → 季度 → 月 → 周 → 日
- 地理：国家 → 省份 → 城市

---

### Q10: 如何分享仪表盘给他人？

**A**: 
有三种方式：
1. **导出 HTML** - 发送文件即可，对方用浏览器打开
2. **导出 PDF** - 适合打印或邮件发送
3. **生成分享链接** - 需要部署到服务器（后续版本支持）

---

## 技术支持

如遇到其他问题，请：

1. 查看 [API 文档](API.md)
2. 提交 [Issue](https://github.com/yourusername/bi-visual-analytics/issues)
3. 发送邮件至：contact@example.com

---

## 快捷键

| 功能 | 快捷键 |
|-----|--------|
| 保存配置 | Ctrl + S |
| 刷新数据 | F5 |
| 全屏预览 | F11 |

---

**祝您使用愉快！如有改进建议，欢迎反馈。**
