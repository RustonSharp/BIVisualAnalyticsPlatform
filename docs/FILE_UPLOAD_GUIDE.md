# 文件上传功能使用指南

## 📤 功能概述

BI Visual Analytics Platform 支持通过 Web 界面上传本地 CSV 和 Excel 文件，无需手动配置文件路径。

---

## 🎯 支持的文件格式

- **CSV 文件**: `.csv`
- **Excel 文件**: `.xls`, `.xlsx`

---

## 📝 使用步骤

### 1. 启动应用

```bash
python app.py
```

在浏览器中访问 `http://localhost:8050`

### 2. 进入数据源配置

- 点击顶部导航栏的 **"数据源"** 菜单

### 3. 选择数据源类型

- 在 "数据源类型" 下拉框中选择 **"CSV/Excel"**

### 4. 上传文件

有两种方式选择文件：

#### 方式一：点击上传按钮（推荐）

1. 点击 **"点击选择 CSV/Excel 文件"** 按钮
2. 在弹出的文件选择对话框中选择本地文件
3. 系统会自动上传文件并显示成功消息
4. 文件路径会自动填入到 "文件路径" 输入框

#### 方式二：手动输入路径

1. 直接在 "或输入文件路径" 输入框中输入文件路径
2. 支持相对路径（如 `data/sales.csv`）
3. 支持绝对路径（如 `D:\data\sales.xlsx`）

### 5. 配置文件参数

**对于 CSV 文件：**
- **编码方式**: 选择文件编码（UTF-8、GBK、GB2312）
- **分隔符**: 选择字段分隔符（逗号、制表符、分号）

**对于 Excel 文件：**
- 系统会自动读取第一个工作表
- 如需指定工作表，可在后续版本中配置

### 6. 连接数据源

- 配置完成后，点击 **"连接数据源"** 按钮
- 系统会验证文件并加载数据
- 成功后可在 "图表设计" 中使用该数据

---

## 📁 文件存储位置

上传的文件会保存在项目的 `uploads/` 目录下：

```
BIVisualAnalyticsPlatform/
├── uploads/              # 用户上传的文件
│   ├── sales_2024.csv
│   ├── products.xlsx
│   └── ...
```

**注意**: 
- `uploads/` 目录已添加到 `.gitignore`，不会提交到版本控制
- 建议定期清理不需要的上传文件

---

## ✅ 支持的文件特性

### CSV 文件
- ✅ 自定义分隔符（逗号、制表符、分号等）
- ✅ 多种编码格式（UTF-8、GBK、GB2312）
- ✅ 自动类型推断（数值、文本、日期）
- ✅ 中文列名支持

### Excel 文件
- ✅ `.xls` 和 `.xlsx` 格式
- ✅ 自动读取第一个工作表
- ✅ 保留单元格格式
- ✅ 日期时间类型识别

---

## 🛠️ 故障排查

### 问题：文件上传失败

**可能原因：**
1. 文件格式不支持（只支持 .csv, .xls, .xlsx）
2. 文件损坏或格式错误
3. 文件过大（建议 < 100MB）
4. 权限不足（无法写入 uploads/ 目录）

**解决方案：**
- 检查文件格式和完整性
- 尝试用 Excel 或文本编辑器打开文件验证
- 确保项目目录有写入权限
- 查看浏览器控制台和应用日志获取详细错误信息

### 问题：上传成功但无法连接

**可能原因：**
1. CSV 编码格式选择错误
2. 分隔符配置不正确
3. Excel 文件为空或无有效数据
4. 列名包含特殊字符

**解决方案：**
- 尝试不同的编码格式（UTF-8 → GBK）
- 检查 CSV 文件实际使用的分隔符
- 确保 Excel 第一个工作表包含数据
- 用文本编辑器查看 CSV 文件前几行

### 问题：中文显示乱码

**解决方案：**
- CSV 文件选择正确的编码格式：
  - Windows Excel 导出的 CSV 通常是 GBK 编码
  - 现代工具导出的通常是 UTF-8
- 可以用记事本另存为 UTF-8 编码

---

## 💡 最佳实践

1. **文件命名**: 使用有意义的英文名称，避免中文和特殊字符
2. **文件大小**: 建议单个文件 < 50MB，保证加载速度
3. **数据清洗**: 上传前清理空行、重复数据、异常值
4. **列名规范**: 使用简洁的列名，避免过长或包含特殊符号
5. **日期格式**: 统一日期格式（如 YYYY-MM-DD），便于时间筛选
6. **备份数据**: 保留原始文件备份，避免误操作

---

## 🔄 示例工作流程

### 场景：分析 Excel 销售数据

1. **准备数据**
   ```
   有一个 sales_report.xlsx 文件，包含：
   - 日期
   - 产品名称
   - 销售金额
   - 销售数量
   - 地区
   ```

2. **上传文件**
   - 打开应用 → 数据源
   - 选择 "CSV/Excel"
   - 点击上传按钮，选择 `sales_report.xlsx`
   - 等待上传成功提示

3. **连接数据**
   - 点击 "连接数据源"
   - 系统自动读取 Excel 第一个工作表

4. **创建图表**
   - 进入 "图表设计"
   - 选择折线图
   - X 轴拖入 "日期"
   - Y 轴拖入 "销售金额"
   - 分组拖入 "地区"

5. **添加筛选**
   - 配置日期范围筛选器
   - 添加产品多选筛选器

6. **导出报告**
   - 进入 "导出" 页面
   - 选择 PDF 格式
   - 下载生成的报告

---

## 🔗 相关文档

- [用户指南](USER_GUIDE.md)
- [API 文档](API.md)
- [快速开始](QUICKSTART.md)
- [主 README](../README.md)

---

## 📞 技术支持

如有问题，请查看：
- 项目 Issues: https://github.com/yourusername/bi-visual-analytics/issues
- 文档: `docs/` 目录
- 示例: `examples/` 目录
