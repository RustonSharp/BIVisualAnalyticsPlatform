# BI æ•°æ®å¯è§†åŒ–ä¸åˆ†æå¹³å° - é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•é…ç½®æ•°æ®æºå’Œå›¾è¡¨ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨ BI å¹³å°ã€‚

## ğŸ“‹ ç›®å½•

1. [æ•°æ®æºé…ç½®](#æ•°æ®æºé…ç½®)
2. [å›¾è¡¨é…ç½®](#å›¾è¡¨é…ç½®)
3. [é…ç½®ç¤ºä¾‹](#é…ç½®ç¤ºä¾‹)
4. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ•°æ®æºé…ç½®

æ•°æ®æºé…ç½®æ–‡ä»¶ï¼š`datasource_config.yaml` æˆ– `config/datasources.yaml`

### 1. æœ¬åœ°æ–‡ä»¶æ•°æ®æº

æ”¯æŒ CSV å’Œ Excel (.xls, .xlsx) æ–‡ä»¶ã€‚

```yaml
- id: ds_file_001
  type: file
  name: é”€å”®æ•°æ®_CSV
  file_path: uploads/sales_data.csv
  # å¯é€‰ï¼šå­—æ®µæ˜ å°„
  field_mapping:
    date: date
    amount: numeric
    category: text
```

**é…ç½®è¯´æ˜ï¼š**
- `id`: æ•°æ®æºå”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨æŒ‡å®šï¼‰
- `type`: å¿…é¡»ä¸º `file`
- `name`: æ•°æ®æºæ˜¾ç¤ºåç§°
- `file_path`: æ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
- `field_mapping`: å¯é€‰ï¼Œç”¨äºæŒ‡å®šå­—æ®µç±»å‹

### 2. æ•°æ®åº“æ•°æ®æº

æ”¯æŒ PostgreSQL å’Œ MySQL æ•°æ®åº“ã€‚

```yaml
- id: ds_db_001
  type: database
  name: ç”Ÿäº§æ•°æ®åº“_PostgreSQL
  engine: postgresql        # æˆ– mysql
  host: localhost
  port: 5432                # PostgreSQL: 5432, MySQL: 3306
  database: sales_db
  user: admin
  password: "your_password"
  sql: "SELECT * FROM sales WHERE date >= CURRENT_DATE - INTERVAL '30 days'"
  table: sales              # å¦‚æœä½¿ç”¨é»˜è®¤æŸ¥è¯¢ï¼Œéœ€è¦æŒ‡å®šè¡¨å
```

**é…ç½®è¯´æ˜ï¼š**
- `engine`: æ•°æ®åº“ç±»å‹ï¼Œ`postgresql` æˆ– `mysql`
- `host`: æ•°æ®åº“ä¸»æœºåœ°å€
- `port`: æ•°æ®åº“ç«¯å£å·
- `database`: æ•°æ®åº“åç§°
- `user`: æ•°æ®åº“ç”¨æˆ·å
- `password`: æ•°æ®åº“å¯†ç ï¼ˆå»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
- `sql`: å¯é€‰ï¼Œè‡ªå®šä¹‰ SQL æŸ¥è¯¢è¯­å¥
- `table`: å¯é€‰ï¼Œè¡¨åï¼ˆå½“ä½¿ç”¨é»˜è®¤æŸ¥è¯¢æ—¶ï¼‰

**å®‰å…¨æç¤ºï¼š**
- å¯†ç å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸è¦ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶ä¸­
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨åªè¯»æ•°æ®åº“ç”¨æˆ·

### 3. REST API æ•°æ®æº

æ”¯æŒ GET å’Œ POST è¯·æ±‚ã€‚

```yaml
- id: ds_api_001
  type: api
  name: é”€å”®APIæ•°æ®
  url: https://api.example.com/sales/data
  method: GET              # æˆ– POST
  params:                  # GET è¯·æ±‚å‚æ•°
    start_date: "2025-01-01"
    end_date: "2025-01-31"
  headers:                 # è¯·æ±‚å¤´
    Authorization: "Bearer your_token_here"
    Content-Type: "application/json"
  json_body: null          # POST è¯·æ±‚çš„ JSON ä½“
  data_path: "data.results"  # å¯é€‰ï¼Œå¦‚æœæ•°æ®åœ¨åµŒå¥—å¯¹è±¡ä¸­
```

**é…ç½®è¯´æ˜ï¼š**
- `url`: API åœ°å€
- `method`: è¯·æ±‚æ–¹æ³•ï¼Œ`GET` æˆ– `POST`
- `params`: GET è¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ï¼ˆå­—å…¸æ ¼å¼ï¼‰
- `headers`: HTTP è¯·æ±‚å¤´ï¼ˆå­—å…¸æ ¼å¼ï¼‰
- `json_body`: POST è¯·æ±‚çš„ JSON è¯·æ±‚ä½“ï¼ˆå­—å…¸æ ¼å¼ï¼‰
- `data_path`: å¯é€‰ï¼Œå¦‚æœ API è¿”å›çš„æ•°æ®åœ¨åµŒå¥—å¯¹è±¡ä¸­ï¼ŒæŒ‡å®šè·¯å¾„ï¼ˆå¦‚ `"data.results"`ï¼‰

**API æ•°æ®æ ¼å¼è¦æ±‚ï¼š**
- API å¿…é¡»è¿”å› JSON æ ¼å¼æ•°æ®
- æ•°æ®åº”ä¸ºæ•°ç»„æ ¼å¼ï¼Œæˆ–å¯é€šè¿‡ `data_path` è®¿é—®åˆ°æ•°ç»„
- æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ä¸ºå¯¹è±¡ï¼ŒåŒ…å«å­—æ®µåå’Œå€¼

---

## å›¾è¡¨é…ç½®

å›¾è¡¨é…ç½®æ–‡ä»¶ï¼š`chart_config.json` æˆ– `config/charts.json`

### åŸºæœ¬é…ç½®ç»“æ„

```json
{
  "id": "chart_001",
  "name": "å›¾è¡¨åç§°",
  "datasource_id": "ds_file_001",
  "type": "line",
  "x": "date",
  "y": "amount",
  "title": "å›¾è¡¨æ ‡é¢˜",
  "color_theme": "default",
  "agg_function": "sum"
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `id` | string | æ˜¯ | å›¾è¡¨å”¯ä¸€æ ‡è¯†ç¬¦ |
| `name` | string | æ˜¯ | å›¾è¡¨åç§° |
| `datasource_id` | string | æ˜¯ | å…³è”çš„æ•°æ®æº ID |
| `type` | string | æ˜¯ | å›¾è¡¨ç±»å‹ï¼š`line`, `bar`, `pie`, `table`, `combo` |
| `x` | string | æ˜¯ | X è½´å­—æ®µå |
| `y` | string | æ˜¯ | Y è½´å­—æ®µåï¼ˆé¥¼å›¾å’Œè¡¨æ ¼é™¤å¤–ï¼‰ |
| `group` | string/null | å¦ | åˆ†ç»„å­—æ®µï¼ˆç”¨äºå¤šç³»åˆ—å›¾è¡¨ï¼‰ |
| `title` | string | æ˜¯ | å›¾è¡¨æ ‡é¢˜ |
| `color_theme` | string | æ˜¯ | é¢œè‰²ä¸»é¢˜ï¼š`default`, `blue`, `green`, `purple` |
| `custom_colors` | object | å¦ | è‡ªå®šä¹‰é¢œè‰²æ˜ å°„ |
| `show_labels` | boolean | å¦ | æ˜¯å¦æ˜¾ç¤ºæ•°æ®æ ‡ç­¾ |
| `show_legend` | boolean | å¦ | æ˜¯å¦æ˜¾ç¤ºå›¾ä¾‹ |
| `agg_function` | string | æ˜¯ | èšåˆå‡½æ•°ï¼š`sum`, `avg`, `count`, `max`, `min`, `none` |

### å›¾è¡¨ç±»å‹è¯¦è§£

#### 1. æŠ˜çº¿å›¾ (line)

ç”¨äºå±•ç¤ºæ•°æ®éšæ—¶é—´æˆ–ç±»åˆ«çš„å˜åŒ–è¶‹åŠ¿ã€‚

```json
{
  "type": "line",
  "x": "date",
  "y": "amount",
  "group": "category"  // å¯é€‰ï¼Œç”¨äºå¤šç³»åˆ—
}
```

**é€‚ç”¨åœºæ™¯ï¼š**
- æ—¶é—´åºåˆ—æ•°æ®
- è¶‹åŠ¿åˆ†æ
- å¤šç³»åˆ—å¯¹æ¯”

#### 2. æŸ±çŠ¶å›¾ (bar)

ç”¨äºå¯¹æ¯”ä¸åŒç±»åˆ«çš„æ•°å€¼ã€‚

```json
{
  "type": "bar",
  "x": "category",
  "y": "amount",
  "group": null
}
```

**é€‚ç”¨åœºæ™¯ï¼š**
- ç±»åˆ«å¯¹æ¯”
- æ’ååˆ†æ
- åˆ†ç±»ç»Ÿè®¡

#### 3. é¥¼å›¾ (pie)

ç”¨äºå±•ç¤ºå„éƒ¨åˆ†å æ•´ä½“çš„æ¯”ä¾‹ã€‚

```json
{
  "type": "pie",
  "x": "category",
  "y": "amount",
  "group": null
}
```

**é€‚ç”¨åœºæ™¯ï¼š**
- å æ¯”åˆ†æ
- ç»„æˆç»“æ„
- æ¯”ä¾‹å±•ç¤º

#### 4. è¡¨æ ¼ (table)

ç”¨äºå±•ç¤ºè¯¦ç»†çš„æ•°æ®æ˜ç»†ã€‚

```json
{
  "type": "table",
  "table_columns": ["date", "category", "amount", "quantity"],
  "table_orientation": "horizontal"
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `table_columns`: è¦æ˜¾ç¤ºçš„åˆ—åæ•°ç»„
- `table_orientation`: è¡¨æ ¼æ–¹å‘ï¼Œ`horizontal` æˆ– `vertical`

#### 5. ç»„åˆå›¾ (combo)

åŒæ—¶å±•ç¤ºä¸¤ç§ä¸åŒç±»å‹çš„å›¾è¡¨ï¼ˆå¦‚æŸ±çŠ¶å›¾+æŠ˜çº¿å›¾ï¼‰ã€‚

```json
{
  "type": "combo",
  "x": "date",
  "y": "revenue",      // ä¸» Y è½´ï¼ˆæŸ±çŠ¶å›¾ï¼‰
  "y2": "order_count", // æ¬¡ Y è½´ï¼ˆæŠ˜çº¿å›¾ï¼‰
  "group": null
}
```

**é€‚ç”¨åœºæ™¯ï¼š**
- å¤šæŒ‡æ ‡å¯¹æ¯”
- å…³è”åˆ†æ
- åŒè½´å±•ç¤º

### æ ·å¼é…ç½®

#### é¢œè‰²ä¸»é¢˜

ç³»ç»Ÿæä¾›ä»¥ä¸‹é¢„è®¾ä¸»é¢˜ï¼š
- `default`: é»˜è®¤ä¸»é¢˜ï¼ˆ10 ç§é¢œè‰²ï¼‰
- `blue`: è“è‰²ä¸»é¢˜
- `green`: ç»¿è‰²ä¸»é¢˜
- `purple`: ç´«è‰²ä¸»é¢˜

#### è‡ªå®šä¹‰é¢œè‰²

å¯ä»¥ä¸ºç‰¹å®šåˆ†ç±»æŒ‡å®šé¢œè‰²ï¼š

```json
{
  "custom_colors": {
    "ç”µå­äº§å“": "#1f77b4",
    "æœè£…": "#ff7f0e",
    "é£Ÿå“": "#2ca02c"
  }
}
```

### ç­›é€‰è§„åˆ™

å¯ä»¥ä¸ºå›¾è¡¨é…ç½®ç­›é€‰è§„åˆ™ï¼š

```json
{
  "filters": {
    "date_range": {
      "enabled": true,
      "start": "2025-01-01",
      "end": "2025-01-31"
    },
    "value_filters": {
      "enabled": true,
      "min_value": 100,
      "max_value": 10000
    },
    "category_filters": {
      "enabled": true,
      "included_categories": ["ç”µå­äº§å“", "æœè£…"]
    }
  }
}
```

### äº¤äº’è§„åˆ™

#### å›¾è¡¨è”åŠ¨

é…ç½®å›¾è¡¨ä¹‹é—´çš„è”åŠ¨å…³ç³»ï¼š

```json
{
  "interaction_rules": {
    "chart_linking": {
      "enabled": true,
      "source_chart_id": "chart_001",
      "target_chart_ids": ["chart_002", "chart_003"],
      "link_type": "filter"
    }
  }
}
```

#### æ•°æ®ä¸‹é’»

é…ç½®æ•°æ®ä¸‹é’»åŠŸèƒ½ï¼š

```json
{
  "interaction_rules": {
    "drill_down": {
      "enabled": true,
      "drill_levels": ["å…¨å›½", "çœä»½", "åŸå¸‚"],
      "drill_field": "region"
    }
  }
}
```

---

## é…ç½®ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹ï¼šé”€å”®æ•°æ®åˆ†æ

#### 1. æ•°æ®æºé…ç½®

```yaml
datasources:
  - id: ds_sales_001
    type: file
    name: é”€å”®æ•°æ®
    file_path: uploads/sales_data.csv
```

#### 2. å›¾è¡¨é…ç½®

```json
{
  "charts": [
    {
      "id": "chart_sales_trend",
      "name": "é”€å”®é¢è¶‹åŠ¿",
      "datasource_id": "ds_sales_001",
      "type": "line",
      "x": "date",
      "y": "amount",
      "title": "é”€å”®é¢è¶‹åŠ¿åˆ†æ",
      "color_theme": "default",
      "agg_function": "sum"
    },
    {
      "id": "chart_category_pie",
      "name": "åˆ†ç±»å æ¯”",
      "datasource_id": "ds_sales_001",
      "type": "pie",
      "x": "category",
      "y": "amount",
      "title": "é”€å”®åˆ†ç±»å æ¯”",
      "color_theme": "default",
      "agg_function": "sum"
    }
  ]
}
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•é…ç½®æ•°æ®åº“è¿æ¥ï¼Ÿ

A: åœ¨ `datasource_config.yaml` ä¸­æ·»åŠ æ•°æ®åº“é…ç½®ï¼Œç¡®ä¿ï¼š
1. æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ
2. ç½‘ç»œè¿æ¥æ­£å¸¸
3. ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®
4. æ•°æ®åº“ç”¨æˆ·æœ‰ç›¸åº”æƒé™

### Q2: API æ•°æ®æºè¿”å›çš„æ•°æ®æ ¼å¼ä¸å¯¹æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. API è¿”å›çš„æ˜¯ JSON æ ¼å¼
2. æ•°æ®æ˜¯æ•°ç»„æ ¼å¼æˆ–å¯é€šè¿‡ `data_path` è®¿é—®
3. å¦‚æœæ•°æ®åœ¨åµŒå¥—å¯¹è±¡ä¸­ï¼Œä½¿ç”¨ `data_path` æŒ‡å®šè·¯å¾„

### Q3: å¦‚ä½•è‡ªå®šä¹‰å›¾è¡¨é¢œè‰²ï¼Ÿ

A: åœ¨å›¾è¡¨é…ç½®ä¸­ä½¿ç”¨ `custom_colors` å­—æ®µï¼Œä¸ºæ¯ä¸ªåˆ†ç±»æŒ‡å®šé¢œè‰²å€¼ï¼ˆåå…­è¿›åˆ¶æ ¼å¼ï¼‰ã€‚

### Q4: å›¾è¡¨ä¸æ˜¾ç¤ºæ•°æ®æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ•°æ®æº ID æ˜¯å¦æ­£ç¡®
2. å­—æ®µåæ˜¯å¦å­˜åœ¨äºæ•°æ®æºä¸­
3. å­—æ®µç±»å‹æ˜¯å¦åŒ¹é…ï¼ˆå¦‚æ—¥æœŸå­—æ®µéœ€è¦æ˜¯æ—¥æœŸç±»å‹ï¼‰
4. æ•°æ®æºè¿æ¥æ˜¯å¦æ­£å¸¸

### Q5: å¦‚ä½•é…ç½®å›¾è¡¨è”åŠ¨ï¼Ÿ

A: åœ¨å›¾è¡¨é…ç½®çš„ `interaction_rules.chart_linking` ä¸­é…ç½®ï¼š
- `source_chart_id`: æºå›¾è¡¨ ID
- `target_chart_ids`: ç›®æ ‡å›¾è¡¨ ID æ•°ç»„
- `link_type`: è”åŠ¨ç±»å‹ï¼ˆå¦‚ `filter`ï¼‰

### Q6: æ”¯æŒå“ªäº›èšåˆå‡½æ•°ï¼Ÿ

A: æ”¯æŒä»¥ä¸‹èšåˆå‡½æ•°ï¼š
- `sum`: æ±‚å’Œ
- `avg`: å¹³å‡å€¼
- `count`: è®¡æ•°
- `max`: æœ€å¤§å€¼
- `min`: æœ€å°å€¼
- `none`: ä¸èšåˆï¼ˆæ˜¾ç¤ºåŸå§‹æ•°æ®ï¼‰

---

## æ›´å¤šèµ„æº

- æŸ¥çœ‹ `datasource_config.yaml` è·å–å®Œæ•´çš„æ•°æ®æºé…ç½®ç¤ºä¾‹
- æŸ¥çœ‹ `chart_config.json` è·å–å®Œæ•´çš„å›¾è¡¨é…ç½®ç¤ºä¾‹
- æŸ¥çœ‹ `README-CN.md` è·å–å¹³å°ä½¿ç”¨æŒ‡å—

---

**æœ€åæ›´æ–°ï¼š** 2025-01-10

