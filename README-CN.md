# BI 数据可视化与分析平台

完整的 BI 数据可视化与分析平台，支持多数据源接入、拖拽式图表配置、交互式仪表盘管理。

## 功能特性

### 1. 数据源管理
- ✅ **本地文件上传**：支持 CSV、Excel (.xls, .xlsx) 文件上传
- ✅ **数据库连接**：支持 PostgreSQL、MySQL 数据库连接
- ✅ **REST API**：支持通过 API 获取 JSON 数据
- ✅ **自动字段识别**：自动识别字段类型（文本、数字、日期）
- ✅ **数据预览**：实时预览数据内容

### 2. 图表设计器
- ✅ **多种图表类型**：折线图、柱状图、饼图、表格、组合图
- ✅ **拖拽式配置**：通过拖拽字段配置 X 轴、Y 轴、分组
- ✅ **聚合函数**：支持求和、平均值、计数、最大值、最小值
- ✅ **样式定制**：自定义图表标题、颜色主题、显示选项
- ✅ **实时预览**：配置后实时查看图表效果

### 3. 仪表盘管理
- ✅ **网格布局**：灵活的图表网格布局
- ✅ **时间筛选**：支持快捷时间范围筛选（今天、近7天、近30天等）
- ✅ **自定义日期范围**：支持自定义起始和结束日期
- ✅ **多图表展示**：在一个页面展示多个图表
- ✅ **数据表格**：展示明细数据表格
- ✅ **图表联动**：点击图表数据点可筛选其他图表
- ✅ **数据下钻**：点击图表数据点可查看详细数据
- ✅ **导出功能**：支持导出为 PNG、PDF、HTML 格式

### 4. 配置管理
- ✅ **数据源配置**：保存数据源配置到 YAML 文件
- ✅ **图表配置**：保存图表配置到 JSON 文件
- ✅ **仪表盘配置**：保存仪表盘配置到 JSON 文件
- ✅ **导入/导出**：支持配置的导入和导出
- ✅ **语言设置**：支持中文/英文切换

### 5. 数据处理
- ✅ **字段类型识别**：自动识别文本、数字、日期类型（支持多种日期格式）
- ✅ **数据聚合**：支持多种聚合函数
- ✅ **数据筛选**：支持条件筛选和时间筛选
- ✅ **缓存机制**：数据源适配器缓存，提升性能
- ✅ **性能监控**：内置性能日志记录

## 技术栈

- **前端框架**：Plotly Dash + Dash Bootstrap Components
- **可视化库**：Plotly
- **数据处理**：Pandas
- **数据库连接**：SQLAlchemy
- **配置管理**：PyYAML
- **文件处理**：openpyxl (Excel)
- **日志管理**：Python logging (支持日志轮转)
- **导出工具**：Kaleido / Playwright / imgkit (可选)

## 安装依赖

```bash
pip install -r requirements.txt
```

## 运行应用

```bash
python app.py
```

应用将在 `http://localhost:8050` 启动。

## 项目结构

```
BIVisualAnalyticsPlatform/
├── app.py                  # 主应用文件（Dash 应用）
├── config_manager.py       # 配置管理器（保存/加载配置）
├── data_adapter.py         # 数据源适配器（统一数据源接口）
├── chart_engine.py         # 图表生成引擎（生成各种图表）
├── logger.py              # 日志管理模块
├── language_manager.py    # 语言管理模块（中英文支持）
├── requirements.txt       # Python 依赖列表
├── pages/                 # 页面模块
│   ├── datasource_page.py    # 数据源管理页面
│   ├── chart_designer_page.py # 图表设计器页面
│   ├── dashboard_page.py     # 仪表盘页面
│   └── settings_page.py      # 设置页面
├── components/            # UI 组件
│   ├── sidebar.py         # 侧边栏组件
│   └── common.py          # 通用组件
├── tools/                 # 工具模块
│   ├── load_data.py       # 数据加载工具（文件、数据库、API）
│   └── export_utils.py    # 导出工具（PNG、PDF、HTML）
├── styles/                # 样式文件
│   └── custom.py          # 自定义样式
├── assets/                # 静态资源
│   ├── chart_designer.css  # 图表设计器样式
│   └── chart_designer.js   # 图表设计器脚本
├── config/               # 配置目录（自动创建）
│   ├── datasources.yaml  # 数据源配置
│   ├── charts.json       # 图表配置
│   ├── dashboards.json   # 仪表盘配置
│   └── language.json     # 语言设置
├── uploads/              # 上传文件目录（自动创建）
├── exports/              # 导出文件目录（自动创建）
├── logs/                 # 日志目录（自动创建）
├── test_data/            # 测试数据
│   ├── sample_data.csv   # 示例数据
│   └── combo_chart_data.csv # 组合图示例数据
└── examples/             # 配置示例
    ├── datasource_config.yaml    # 数据源配置示例
    ├── datasource_config_en.yaml # 数据源配置示例（英文）
    ├── chart_config.json         # 图表配置示例
    └── chart_config_en.json      # 图表配置示例（英文）
```

## 使用指南

### 1. 添加数据源

#### 上传本地文件
1. 点击"数据源管理" → "新增数据源"
2. 选择"本地文件"标签页
3. 拖拽或选择 CSV/Excel 文件
4. 输入数据源名称
5. 点击"测试连接"验证
6. 点击"保存"完成配置

#### 连接数据库
1. 选择"数据库"标签页
2. 选择数据库类型（PostgreSQL/MySQL）
3. 填写连接信息（主机、端口、数据库名、用户名、密码）
4. 输入数据源名称
5. 点击"测试连接"验证
6. 点击"保存"完成配置

#### 连接 API
1. 选择"REST API"标签页
2. 输入 API 地址
3. 选择请求方法（GET/POST）
4. 配置请求头和参数（可选，JSON 格式）
5. 输入数据源名称
6. 点击"测试连接"验证
7. 点击"保存"完成配置

### 2. 创建图表

1. 点击"图表设计器"
2. 选择数据源
3. 选择图表类型（折线图/柱状图/饼图/表格/组合图）
4. 配置字段：
   - X 轴：拖拽日期或分类字段
   - Y 轴：拖拽数值字段
   - 分组/颜色：拖拽分类字段（可选）
5. 选择聚合函数（求和/平均值/计数等）
6. 配置样式：
   - 图表标题
   - 颜色主题
   - 显示选项（数据标签、图例）
7. 查看右侧预览效果
8. 点击"保存图表"保存配置

### 3. 创建仪表盘

1. 点击"仪表盘"
2. 选择或创建仪表盘
3. 使用时间筛选器过滤数据（今天、近7天、近30天、自定义范围等）
4. 查看已保存的图表
5. **图表联动**：
   - 切换到"筛选模式"，点击图表数据点可筛选其他图表
   - 切换到"下钻模式"，点击图表数据点可查看详细数据
6. 点击"导出"导出为 PNG/PDF/HTML

### 4. 配置管理

1. 点击"设置"
2. **通用设置**：
   - 配置自动刷新间隔
   - 设置默认图表主题
3. **数据源配置**：
   - 导出所有数据源配置
   - 导入数据源配置
4. **语言设置**：
   - 切换界面语言（中文/English）

## 配置说明

### 数据源配置 (config/datasources.yaml)

```yaml
datasources:
  - id: ds_1_1234567890
    type: file
    name: 销售数据_CSV
    file_path: uploads/sales.csv
    created_at: "2025-01-10T10:00:00"
    updated_at: "2025-01-10T10:00:00"
```

### 图表配置 (config/charts.json)

```json
{
  "charts": [
    {
      "id": "chart_1_1234567890",
      "datasource_id": "ds_1_1234567890",
      "type": "line",
      "x": "date",
      "y": "value",
      "title": "销售额趋势",
      "color_theme": "default",
      "agg_function": "sum"
    }
  ]
}
```

## 性能优化

- **数据限制**：默认限制数据量为 1000 行（可在配置中调整）
- **缓存机制**：数据源适配器缓存数据，避免重复加载
- **分页加载**：大数据量时自动分页处理

## 注意事项

1. **文件上传**：上传的文件保存在 `uploads/` 目录
2. **配置保存**：所有配置自动保存到 `config/` 目录
3. **数据库连接**：确保数据库允许远程连接（如需要）
4. **API 请求**：API 需要返回 JSON 格式数据
5. **导出功能**：
   - PNG/PDF 导出需要安装以下库之一：`kaleido`、`playwright` 或 `imgkit`
   - 推荐使用 `kaleido`：`pip install kaleido`
   - 或使用 `playwright`：`pip install playwright && playwright install chromium`
6. **日志文件**：日志文件保存在 `logs/` 目录，支持按日期轮转
7. **语言切换**：语言设置保存在 `config/language.json`，重启应用后生效

## 开发计划

### 已完成 ✅
- 数据源管理（文件、数据库、API）
- 图表生成引擎（多种图表类型）
- 配置管理（保存/加载）
- 仪表盘基础功能
- 字段类型识别（支持多种日期格式）
- **图表联动功能**（点击筛选）
- **数据下钻功能**
- **导出功能**（PNG/PDF/HTML）
- **语言支持**（中文/英文）
- **日志管理**（支持日志轮转和性能监控）
- **代码重构**（类型安全、模块化）

### 待开发 🚧
- 实时数据刷新（定时自动刷新）
- 异常数据标记（超出阈值的数据标红提醒）
- 高级筛选选项（多条件组合筛选）
- 自定义日期格式配置

## 许可证

本项目仅用于学习和演示目的。

## 更新日志

### v1.1.0 (2025-12-07)
- ✅ 新增导出功能（PNG/PDF/HTML）
- ✅ 新增图表联动功能（点击筛选）
- ✅ 新增数据下钻功能
- ✅ 新增语言支持（中文/英文切换）
- ✅ 改进日期字段类型识别（支持多种日期格式）
- ✅ 代码重构和类型安全改进
- ✅ 日志管理系统优化（支持日志轮转）
- ✅ 项目结构优化（工具模块化）

### v1.0.0 (2025-01-10)
- 初始版本发布
- 完整的数据源管理功能
- 完整的图表设计器功能
- 基础的仪表盘功能
- 配置管理功能

